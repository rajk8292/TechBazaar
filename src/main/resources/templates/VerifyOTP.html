<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OTP Verification</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>

body {
    background: linear-gradient(135deg, #0d6efd, #0a58ca);
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.card {
    backdrop-filter: blur(15px);
    background: rgba(255, 255, 255, 0.15);
    border-radius: 20px;
    border: none;
    color: white;
}

.otp-input {
    width: 55px;
    height: 60px;
    font-size: 22px;
    text-align: center;
    border-radius: 10px;
    border: 2px solid #ffffff55;
    background: rgba(255,255,255,0.2);
    color: white;
    transition: 0.3s;
}

.otp-input:focus {
    border-color: white;
    box-shadow: 0 0 10px white;
}

.circle-wrapper {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 20px auto;
}

svg {
    transform: rotate(-90deg);
}

circle {
    fill: none;
    stroke-width: 8;
    stroke-linecap: round;
}

.bg-circle {
    stroke: rgba(255,255,255,0.3);
}

.progress-circle {
    stroke: white;
    stroke-dasharray: 314;
    stroke-dashoffset: 0;
    transition: stroke-dashoffset 1s linear;
}

.timer-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: bold;
    font-size: 22px;
}

.btn-primary {
    background: white;
    color: #0d6efd;
    font-weight: 600;
    border-radius: 10px;
}

.btn-primary:hover {
    background: #e6e6e6;
    color: #0d6efd;
}

a {
    color: white;
}

</style>
</head>

<body>

<div class="col-md-4">
  <div class="card shadow p-4 text-center">

    <h4 class="mb-2">Verify Your Account</h4>
    <p>Enter 6 digit OTP</p>

    <form id="otpForm" action="/verify-otp" method="post">

      <div class="d-flex justify-content-between mb-3">
        <input type="text" maxlength="1" class="form-control otp-input" required>
        <input type="text" maxlength="1" class="form-control otp-input" required>
        <input type="text" maxlength="1" class="form-control otp-input" required>
        <input type="text" maxlength="1" class="form-control otp-input" required>
        <input type="text" maxlength="1" class="form-control otp-input" required>
        <input type="text" maxlength="1" class="form-control otp-input" required>
      </div>

      <input type="hidden" name="otp" id="finalOtp">

      <button type="submit" class="btn btn-primary w-100">
        Verify OTP
      </button>
    </form>

    <!-- Circular Timer -->
    <div class="circle-wrapper">
      <svg width="120" height="120">
        <circle cx="60" cy="60" r="50" class="bg-circle"></circle>
        <circle cx="60" cy="60" r="50" class="progress-circle" id="progressCircle"></circle>
      </svg>
      <div class="timer-text" id="timerText">60</div>
    </div>

    <div>
      <a href="/ResendOTP">Resend OTP</a>
    </div>

  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const inputs = document.querySelectorAll(".otp-input");
    const progressCircle = document.getElementById("progressCircle");
    const timerText = document.getElementById("timerText");
    const form = document.getElementById("otpForm");

    const totalTime = 60;
    const radius = 50;
    const circumference = 2 * Math.PI * radius;

    progressCircle.style.strokeDasharray = circumference;
    progressCircle.style.strokeDashoffset = 0;


    inputs.forEach((input, index) => {

        input.addEventListener("input", function() {
            this.value = this.value.replace(/[^0-9]/g, '');
            if (this.value.length === 1 && index < inputs.length - 1) {
                inputs[index + 1].focus();
            }
        });

        input.addEventListener("keydown", function(e) {
            if (e.key === "Backspace" && this.value === "" && index > 0) {
                inputs[index - 1].focus();
            }
        });
    });

  

    let timeLeft = totalTime;

    const timer = setInterval(() => {

        timeLeft--;
        timerText.innerText = timeLeft;

        const offset = circumference - (timeLeft / totalTime) * circumference;
        progressCircle.style.strokeDashoffset = offset;

        if (timeLeft <= 0) {
            clearInterval(timer);

            Swal.fire({
                icon: 'warning',
                title: 'OTP Expired',
                text: 'Please resend OTP'
            });
        }

    }, 1000);

    

    form.addEventListener("submit", function(e) {

        e.preventDefault();

        let otpValue = "";
        inputs.forEach(input => otpValue += input.value);

        document.getElementById("finalOtp").value = otpValue;

        if(otpValue.length < 6){
            Swal.fire({
                icon: 'error',
                title: 'Incomplete OTP',
                text: 'Please enter all 6 digits'
            });
        } else {

            Swal.fire({
                icon: 'success',
                title: 'Verifying...',
                text: 'Please wait',
                timer: 1000,
                showConfirmButton: false
            }).then(() => {
                form.submit();
            });
        }
    });

});
</script>


</body>
</html>
